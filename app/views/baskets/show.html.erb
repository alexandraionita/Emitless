<div class="comparison-container">
  <div class="basket-container">
    <div class="top-page">
      <div class="header-top-basket">
        <div class="logo-emits">
          <%= image_tag "#{@final_basket.retailer}.png", alt: "#{@final_basket}", class: "image-logo-basket" %>
          <div class="number-text">
            <h2 class="final-emission"><%= @final_basket.emissions.to_i %></h2>
            <div class="emit-price">
              <p class="emits-basket">emits</p>
              <p class="basket-final-price"> £<%= '%.2f' % @final_basket.price %> </p>
            </div>
          </div>
        </div>
        <%= link_to 'Download my list', basket_path(@final_basket, format: :pdf, retailer: @final_basket.retailer, basket: @final_basket), class: "download-btn" %>
      </div>
      <div class="farmer-text">
        <%= image_tag "farmer.png", alt: "farmer" %>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Mauris venenatis lorem viverra tellus auctor pulvinar. In hac habitasse platea dictumst.</p>
      </div>
    </div>

    <div class="row light-bg">
      <div class="col-8">
        <div class="text-headings">
          <p class="basket-title">My Basket</p>
          <p class="basket-title">Suggestoins</p>
        </div>
        <% @final_basket.items.each do |item| %>
          <div class="item-with-swap">
            <div class="product-card">
              <%= image_tag "#{item.image}", class: 'product-image', alt: "alttext" %>
              <div class="product-infos">
                <div class="product-infos-left">
                  <% if item.name == item.retailer %>
                  <% item.name = "#{item.retailer} #{item.generic_name}" %>
                  <% else %>
                  <% item_name = item_name %>
                  <% end %>
                  <h5 class="product-name"><%= item.name %></h5>
                  <% if BasketItem.where(item: item).last.amount == 0 %>
                    <% raise %>
                  <% end %>
                  <p class="product-quantity"><%= BasketItem.where(item: item).last.amount %> x <%= item.quantity %> <%= item.unit %></p>
                </div>
                <div class="product-infos-right">
                  <% if item.emission.to_i == 0 %>
                    <% raise %>
                  <% end %>
                  <h5 class="product-emits"><%= item.emission.to_i * BasketItem.where(item_id: item.id).last.amount %> emits</h5>
                  <p class="product-price">£<%= '%.2f' % (item.price * BasketItem.where(item_id: item.id).last.amount)%></p>
                </div>
              </div>
            </div>
            <div class="swap-btn">
              <%= link_to update_path(@final_basket, swap_out: item, swap_in: item.find_swap), method: :patch do %>
                <%= image_tag "swap.png", alt: "swap item", class: "swapbutton" %>
              <% end %>
            </div>
            <div class="swap-box">
              <% if item.find_swap %>
                <div>
                  <%= item.find_swap.name %>
                  <%= item.find_swap.emission.to_i %>
                </div>
              <% else %>
                <div>Suitable item not found</div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

